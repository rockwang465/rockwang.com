在写：
rockwang.com/myself-project/ansible-kubeadm/roles/devops/

问题：
1. kubeadm init 的config文件有点麻烦，缺少defaults/main.yaml 中的vars定义。
2. keepalived 和 loadbalance 是否需现在就做？

需要优化：
1. k8s.sh： 需要优化，得确认所有镜像都拉取了，没有拉取成功的要直接报错。
2. kubernetes/tasks/ 可以分解一下 install.yaml， 缺少prepare.yaml（infra-ansible）部分的准备。
# 3. tiller版本用的还是旧的2.11.0，新版本还不知道下载地址，得找找。  -----完成
# 4. 使用register 判断，如果kubectl get nodes | grep -i ready 有结果，
   则 kubeadm reset && kubeadm init 不执行。没有结果则执行。
   加一层判断更安全。
   ------------- 完成，通过判断/var/lib/kubernetes/config.yaml 文件存在来进行判断的。
5. 添加分区模块进来。 需要有local-volume charts

6. helm 命令执行失败，应该缺少export，要看下
   然后就弄 pv python环境
7. 另外： helm init 要加 --stable-repo-url 改为离线或者其他地址，否则会加载谷歌的地址。 helm repo list中.
   helm init --upgrade -i registry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.5.1 --stable-repo-url https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts

8. local-volume 一定要加了，不然 prometheus有问题


额外部分，待审查:
A.  /etc/docker/daemon.json 中定义cgroup-driver: 为systemd ，是一个驱动，这个可能要做.否则服务器可能莫名其妙的重启。
inventory/group_vars/all/all.yaml:29:docker_cgroup_driver: 'systemd'
roles/docker/defaults/main.yml:4:docker_cgroup_driver: 'systemd'
roles/docker/templates/daemon.json.j2:2:    "exec-opts": ["native.cgroupdriver={{ docker_cgroup_driver }}"],
Binary file roles/kubernetes/templates/.kubeadm-init.yaml.swp matches
roles/kubernetes/templates/kubeadm-init.yaml:16:    cgroup-driver: "{{ docker_cgroup_driver }}"

